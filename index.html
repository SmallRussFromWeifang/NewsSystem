<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<script type="text/javascript" src="js/jquery/2.0.0/jquery.min.js"></script>
		<link rel="stylesheet" href="css/bootstrap/3.3.6/bootstrap.min.css" />
		<script type="text/javascript" src="js/bootstrap/3.3.6/bootstrap.min.js"></script>
		<link rel="stylesheet" href="css/style.css" />
		<link rel="stylesheet" href="css/main.css" />
		<link rel="stylesheet" href="css/element-ui.css">
		<script type="text/javascript" src="js/vue.min.js"></script>
		<script src="js/element-ui.js"></script>
		<link rel="stylesheet" href="css/buttons.css" />
		<link rel="shortcut icon" href="img/favicon.ico" />
		<title>稷下新闻</title>
	</head>

	<body>
		<div id="app">

			<nav class='navbar navbar-inverse navbar-fixed-top'>
				<div class='container'>
					<div class='navbar-header'>
						<a href='#'>
							<img src='img/Logo.png' />
							<p>稷下新闻</p>
						</a>
					</div>
					<div class='collapse navbar-collapse' id='example-navbar-collapse'>
						<ul class='nav navbar-nav _nav'>
							<li class='active'>
								<a href='#'>
									<span class='glyphicon glyphicon-home'></span> 首 页</a>
							</li>
							<li>
								<a href='inLand.html'>国内</a>
							</li>
							<li>
								<a href='outLand.html'>国际</a>
							</li>
							<li>
								<a href='#'>军事</a>
							</li>
							<li>
								<a href='gitMaster.html'>图片</a>
							</li>
							<li class='dropdown'>
								<a href='#' class='dropdown-toggle' data-toggle='dropdown'>
									专题<b class='caret'></b>
								</a>
								<ul class='dropdown-menu'>
									<li>
										<a href='#'>专题1.0</a>
									</li>
									<li>
										<a href='#'>专题1.1</a>
									</li>
									<li>
										<a href='#'>专题1.2</a>
									</li>
									<li class='divider'></li>
									<li>
										<a href='#'>专题2.0</a>
									</li>
									<li class='divider'></li>
									<li>
										<a href='#'>专题3.0</a>
									</li>
								</ul>
							</li>
						</ul>
						<div class='navbar-right' style="color: white; margin-top: 10px;">
							<span>嗨，欢迎来稷下新闻</span>
							<a href="editInfo.html"><span>{{username}}</span></a>
							<a href="login_register.html" v-if="btnM" class="button button-primary button-rounded button-small">登录</a>
						</div>

					</div>

				</div>

			</nav>
			<div class="container">
				<div class="main_body">
					<el-row :gutter="20">
						<el-col :span="14">
							<div class="grid-content bg-purple">
								<template>
									<el-carousel indicator-position="outside">
										<el-carousel-item v-for="item in 4" :key="item">
											<el-image :src="src">
												<div slot="placeholder" class="image-slot">
													加载中<span class="dot">...</span>
												</div>
											</el-image>
										</el-carousel-item>
									</el-carousel>
								</template>
							</div>
						</el-col>
						<el-col :span="10">
							<div class="grid-content bg-purple">
								<el-tabs type="box-card" class="el-card">
									<el-tab-pane label="点击排行">
										<div v-for="(news, index) in newsVisit" class="text item" style="font-size: 20px; text-align: center;">
											<a :label="news.id" @click="openNews(news)" href="#">
												<span class="numLeft">{{index+1}}<el-divider direction="vertical"></el-divider></span> {{news.title}}
											</a>
										</div>
									</el-tab-pane>
									<el-tab-pane label="评论排行">
										<div v-for="(news, index) in newsComment" class="text item" style="font-size: 20px; text-align: center;">
											<a :label="news.id" @click="openNews(news)" href="#">
												<span class="numLeft">{{index+1}}<el-divider direction="vertical"></el-divider></span> {{news.title}}
											</a>
										</div>
									</el-tab-pane>
								</el-tabs>
							</div>
						</el-col>
					</el-row>
					<el-row :gutter="20">
						<el-col :span="14">
							<div class="partNews">
								<div class="el-card__header bg-white" style="font-size: 20px;">
									最新新闻
								</div>
								<div class="grid-content bg-white" class="content">
									<div v-for="(news, index) in newsByTime" class="text item" style="font-size: 20px; margin-bottom: 10px;margin-left: 30px;">
										<a :label="news.id" @click="openNews(news)" href="#">
											{{news.title}} </a>
									</div>
								</div>
							</div>
							<div class="partNews">
								<div class="el-card__header bg-white" style="font-size: 20px;">
									国内新闻
								</div>
								<div class="grid-content bg-white" class="content">
									<div v-for="(news, index) in newsInland" class="text item" style="font-size: 20px; margin-bottom: 10px;margin-left: 30px;">
										<a :label="news.id" @click="openNews(news)" href="#">
											{{news.title}} </a>
									</div>
								</div>
							</div>
							<div class="partNews">
								<div class="el-card__header bg-white" style="font-size: 20px;">
									国际新闻
								</div>
								<div class="grid-content bg-white" class="content">
									<div v-for="(news, index) in newsOutland" class="text item" style="font-size: 20px; margin-bottom: 10px;margin-left: 30px;">
										<a :label="news.id" @click="openNews(news)" href="#">
											{{news.title}}
										</a>
									</div>
								</div>
							</div>

						</el-col>
						<el-col :span="10">
							<div class="grid-content bg-white" style="padding: 20px 20px;">
								<div class="textitem textIn">
									<a @click="handleMessage" href="#"><i class="el-icon-edit"></i> 稷下新闻意见反馈留言板</a>
								</div>
								<div class="textitem">
									<i class="el-icon-phone"></i> 666-666-6666 欢迎批评指正
								</div>
								<el-divider></el-divider>
								<div class="textitem textIn">
									<span>雨纷纷</span>
									<el-divider direction="vertical"></el-divider>
									<span>旧故里</span>
									<el-divider direction="vertical"></el-divider>
									<span>草木深</span>
								</div>
								<div class="textitem textIn">
									<span>雨纷纷</span>
									<el-divider direction="vertical"></el-divider>
									<span>旧故里</span>
									<el-divider direction="vertical"></el-divider>
									<span>草木深</span>
								</div>
								<div class="textitem textIn">
									<span>雨纷纷</span>
									<el-divider direction="vertical"></el-divider>
									<span>旧故里</span>
									<el-divider direction="vertical"></el-divider>
									<span>草木深</span>
								</div>
								<el-divider></el-divider>
								<div class="textitem">
									违法和不良信息举报电话：010-62675637<br /> 举报邮箱：jubao@Cerdore.com
								</div>
								<el-divider></el-divider>
								<div class="textitem">

									Copyright Chen Xiansen　©1998-2019

								</div>

							</div>
						</el-col>

					</el-row>

				</div>
			</div>
		</div>
		<script>
			new Vue({
				el: '#app',
				data() {
					return {
						newsVisit: {},
						newsComment: {},
						newsByTime: {},
						newsInland: {},
						newsOutland: {},
						user: {},
						username: '',
						btnM: false,
						src: 'https://cube.elemecdn.com/6/94/4d3ea53c084bad6931a56d5158a48jpeg.jpeg'
					}
				},
				methods: {
					handleMessage() {
						var _this = this;
						if(this.user == null) {
							_this.$message.error("您还没有登录,即将跳转至登录页面");
							window.top.location.href = "login_register.html";
						} else {
							this.$prompt('请输入您的意见', '提示', {
								confirmButtonText: '确定',
								cancelButtonText: '取消',
							}).then(({
								value
							}) => {
								$.ajax({
									url: 'http://localhost:8080/msg/addMsg',
									type: 'post',
									data: {
										"content": value,
										"user_id": _this.user.id
									},
									dataType: 'json',
									success: function(data) {
										console.log(data);
										if(data.success) {
											_this.$message.success(data.message);
										} else {
											_this.$message.error(data.message);
										}
									}
								});

							}).catch(() => {
								this.$message({
									type: 'info',
									message: '取消输入'
								});
							});
						}
					},
					loadNewsVisit() {
						var _this = this;
						$.ajax({
							url: 'http://127.0.0.1:8080/news/listNewsByVisit',
							type: 'get',
							dataType: 'json',
							success: function(data) {
								if(data.success) {
									_this.newsVisit = data.data;
									/*console.log(_this.newsVisit);
									_this.$message.success(data.message);*/
								} else {
									_this.$message.error(data.message);
								}
							}

						});
					},
					loadNewsComment() {
						var _this = this;
						$.ajax({
							url: 'http://127.0.0.1:8080/news/listNewsByComment',
							type: 'get',
							dataType: 'json',
							success: function(data) {
								if(data.success) {
									_this.newsComment = data.data;
									console.log(_this.newsComment);
									/*_this.$message.success(data.message);*/
								} else {
									_this.$message.error(data.message);
								}
							}

						});
					},
					loadnewsByTime() {
						var _this = this;
						$.ajax({
							url: 'http://127.0.0.1:8080/news/listNews',
							type: 'get',
							dataType: 'json',
							success: function(data) {
								if(data.success) {
									_this.newsByTime = data.data;
								} else {
									_this.$message.error(data.message);
								}
							}

						});
					},
					loadNewsInland() {
						var _this = this;
						$.ajax({
							url: 'http://127.0.0.1:8080/news/listNewsInland/1',
							type: 'get',
							dataType: 'json',
							success: function(data) {
								if(data.success) {
									_this.newsInland = data.data;
									/*_this.$message.success(data.message);*/
								} else {
									_this.$message.error(data.message);
								}
							}

						});
					},
					loadNewsOutland() {
						var _this = this;
						$.ajax({
							url: 'http://127.0.0.1:8080/news/listNewsInland/0',
							type: 'get',
							dataType: 'json',
							success: function(data) {
								if(data.success) {
									_this.newsOutland = data.data;
									/*_this.$message.success(data.message);*/
								} else {
									_this.$message.error(data.message);
								}
							}

						});
					},
					openNews(news) {
						sessionStorage.setItem("newsId", news.nid);
						window.top.location.href = "article.html";
					}
				},
				mounted() {
					this.user = JSON.parse(sessionStorage.getItem("user"));
					if(this.user == null) this.btnM = true;
					else this.username = this.user.name;
					console.log(this.user);
					this.loadNewsVisit();
					this.loadNewsComment();
					this.loadnewsByTime();
					this.loadNewsInland();
					this.loadNewsOutland();
				}
			});
		</script>
	</body>

</html>